<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-org-chart@3.0.1"></script>
<script src="/admin/js/d3-flextree.js"></script>
<div class="chart-container"></div>

<script>
    let treeList = "<%= JSON.stringify(series) %>"

treeList = treeList.replaceAll('&#34;', '\"');

nodeDataArray = JSON.parse(treeList);

  // This is the data used - https://github.com/bumbeishvili/sample-data/blob/main/data-oracle.csv
  new d3.OrgChart()
      .nodeHeight((d) => 85 + 25)
      .nodeWidth((d) => 220 + 2)
      .childrenMargin((d) => 50)
      .compactMarginBetween((d) => 35)
      .compactMarginPair((d) => 30)
      .neighbourMargin((a, b) => 20)
      .nodeContent(function (d, i, arr, state) {
        const color = '#FFFFFF';
        const imageDiffVert = 25 + 2;
        return `
                <div style='width:${ d.width }px;height:${d.height}px;padding-top:${imageDiffVert - 2}px;padding-left:1px;padding-right:1px'>
                  <div style="font-family: 'Inter', sans-serif;background-color:${color};  margin-left:-1px;width:${d.width - 2}px;height:${d.height - imageDiffVert}px;border-radius:10px;border: 1px solid #E4E2E9">
                    <div style="display:flex;justify-content:flex-end;margin-top:5px;margin-right:8px">#${ d.data.id }</div>
                      <div style="background-color:${color};margin-top:${-imageDiffVert - 20}px;margin-left:${15}px;border-radius:100px;width:50px;height:50px;" ></div>
                        <div style="margin-top:${-imageDiffVert - 15}px;">   
                          <span style="margin-left:${20}px;font-size:30px" >${d.data.image}</span>
                        </div>
                        <div style="font-size:15px;color:#08011E;margin-left:20px;margin-top:10px" onClick="fnMemId('${d.data.name }')">  ${d.data.name } </div>
                        <div style="color:#716E7B;margin-left:20px;margin-top:3px;font-size:10px;"> 이름 : ${ d.data.paid_grade } </div>
                        <div style="color:#716E7B;margin-left:20px;margin-top:3px;font-size:10px;"> 지급 비율 : ${ addCommas(d.data.salary) } </div>
                        
                      </div>
                    </div>
                            `;
      })
      .container('.chart-container')
      .initialExpandLevel(3)
      .data(nodeDataArray)
      .render();


    function addCommas(x) {
      if (x) {
          return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      } else {
          return x;
      }

    }

    function fnMemId(memId) {
      window.parent.fnSearch(memId)
    }
</script>