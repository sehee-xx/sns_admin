<!DOCTYPE html>
<html lang="en-US" dir="ltr">

  <head>
    <%- include('../includes/head.ejs') %>
  </head>

  <body>

    <!-- ===============================================-->
    <!--    Main Content-->
    <!-- ===============================================-->
    <main class="main" id="top">
        <%- include('../includes/menu.ejs') %>
      
        <%- include('../includes/top.ejs') %>
      <div class="content">
        <%- include('../includes/nav.ejs') %>

        <h2 class="text-bold text-1100 mb-5"><%=basicInfo.title%></h2>
        
        <div id="members" >
          <div class="mb-4">
            <div class="d-flex flex-wrap gap-5">
                <%- include('../includes/datepicker.ejs') %>
               
                <div class="search-box">
                    <form class="position-relative" data-bs-toggle="search" data-bs-display="static">
                    <input class="form-control search-input search" id="srchText" type="search" placeholder="선택 조회" aria-label="Search" value="<%= basicInfo.search.srchText %>"/>
                    <span class="fas fa-search search-box-icon"></span>
                    </form>
                </div>
                <div class="col-1">
                  <button class="btn btn-outline-primary me-1 mb-1" type="button" onClick="fnSearch()" >검색</button>
                </div>
                <div class="col-1 ">
                  <select class="form-select" id="rowsPerPage" onChange="fnViewCnt(this)">
                    <option value="20" <% if ( basicInfo.search.rowsPerPage == "10") { %> selected <% } %>>10</option>
                    <option value="20" <% if ( basicInfo.search.rowsPerPage == "20") { %> selected <% } %>>20</option>
                    <option value="50" <% if ( basicInfo.search.rowsPerPage == "50") { %> selected <% } %>>50</option>
                    <option value="100" <% if ( basicInfo.search.rowsPerPage == "100") { %> selected <% } %>>100</option>
                    <option value="300" <% if ( basicInfo.search.rowsPerPage == "300") { %> selected <% } %>>300</option>
                  </select>
              </div>

              <div class="col-1">
                <button class="btn btn-primary my-0"
                data-bs-toggle="modal" data-bs-target="#categoryModal" aria-haspopup="true" aria-expanded="false" data-bs-reference="parent"
                >등록</button>
              </div>
            </div>
          </div>
          <div class="mx-n4 mx-lg-n6 px-4 px-lg-6 mb-9 bg-white border-y border-300 mt-2 position-relative top-1">
            <div class="table-responsive scrollbar ms-n1 ps-1">
              <table class="table table-sm fs--1 mb-0">
                <thead>
                  <tr>
                    <th class="sort align-middle" scope="col"  style="width:10%;">카테고리명</th>
                    <th class="sort align-middle" scope="col"  style="width:10%;">설명</th>
                    <th class="sort align-middle" scope="col"  style="width:10%;">전시여부</th>
                  </tr>
                </thead>
                <tbody class="list" id="members-table-body">
                  
                  <%
                  if (basicInfo.caList.length > 0) {
                  basicInfo.caList.forEach(function (el) { 
                  %>

                  <tr class="hover-actions-trigger btn-reveal-trigger position-static">
                    <td class="city align-middle white-space-nowrap text-900"><%=el.title%></td>
                    <td class="align-middle white-space-nowrap text-700 "> <%=el.memo%></td>
                    <td class="align-middle white-space-nowrap text-700 "><%=el.view_yn%></td>
                  </tr>
                  <% } ) } %>
                </tbody>
              </table>
            </div>
            <%- include('../includes/paging.ejs') %>
          </div>
        </div>
        <!-- footer -->
        <%- include('../includes/footer.ejs') %>
      </div>
   
    </main>
    <!-- ===============================================-->
    <!--    End of Main Content-->
    <!-- ===============================================-->

    <!-- ===============================================-->
    <!--    JavaScripts-->
    <!-- ===============================================-->
    <%- include('../includes/scripts.ejs') %>
    <script src="https://code.jquery.com/jquery-3.6.3.js"></script>
    <%- include('../includes/modal.ejs') %>

    <div class="modal fade" id="categoryModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true">
      <div class="modal-dialog    modal-dialog-centered">
        <div class="modal-content bg-100 p-6">
          <div class="modal-header border-0 p-0 mb-2">
            <h3 class="mb-0" id="memInsUpt">판매상품등록</h3>
            <button class="btn btn-sm btn-phoenix-secondary" data-bs-dismiss="modal" aria-label="Close"><span class="fas fa-times text-danger"></span></button>
          </div>
          <div class="modal-body px-0 ">
            <div class="row  g-1">
              <div class="col-lg-12">
                <div class="mb-4">
                  <label class="text-1000 fw-bold mb-2 fs-0">카테고리 명칭</label>
                  <input class="form-control" type="text" id="pTitle" value="" />
                </div>
              </div>
            </div>
            <div class="row  g-1">
              <div class="col-lg-3">
                <div class="mb-2">
                    <label class="text-1000 fw-bold mb-2 fs-0">전시여부</label>
                    <select class="form-select" id="viewYN" >
                      <option value="Y" >Y</option>
                      <option value="N" >N</option>
                    </select>
                  </div>
              </div>
            </div>
          </div>
          <input type="hidden" id="piSeq" value = "" />
          <div class="modal-footer border-0 pt-6 px-0 pb-0">
            <button class="btn btn-link text-danger px-3 my-0" id="pcancelBtn" data-bs-dismiss="modal" aria-label="Close">취소</button>
            <button class="btn btn-primary my-0" onclick="fnSetCategory()" id="memIns">저장</button>
          </div>
        </div>
      </div>
  </div>

    <script>
  function fnSetCategory(){
    let _url = '/pr/categoryAdd'
    let data = {}

    data.pTitle = $('#pTitle').val()
    data.viewYN = $('#viewYN option:selected').val();
   
    wrapWindowByMaskShow()
    $.ajax({
        url: _url,
        dataType: 'json',
        type: 'POST',
        data: data,
        success: function (result) {
            wrapWindowByMaskHide()
            if(result.success) {
                fnAlertFnSearchMessage("정상 처리 되었습니다. ")
                $('#pcancelBtn').click();
            } else {
                fnAlertMessage(result.message);
            }
        },
        error: function (XMLHttpRequest, textStatus, errorThrown) {
            wrapWindowByMaskHide()
            fnAlertMessage('새로 고침 후 다시 시도하여 주세요');
         
        } //function끝
    });
  }

      function fnSearch(pindex) {
        let pageIndex = $('#pageIndex').val();
        if (pindex != 'undefined' && pindex != undefined) pageIndex = pindex;

        let srchText = $('#srchText').val();
        let srchOption = $('#srchOption option:selected').val();
        let rowsPerPage = $('#rowsPerPage option:selected').val();

        let srtDt = $('#srtDt').val();
        let endDt = $('#endDt').val();

        let form = document.createElement("form");
        form.setAttribute("charset", "UTF-8");
        form.setAttribute("method", "Post");
        form.setAttribute("action", "/pr/category");

        let hiddenField1 = document.createElement("input");
        hiddenField1.setAttribute("type", "hidden");
        hiddenField1.setAttribute("name", "pageIndex");
        hiddenField1.setAttribute("value", pageIndex);
        form.appendChild(hiddenField1);

        let hiddenField2 = document.createElement("input");
        hiddenField2.setAttribute("type", "hidden");
        hiddenField2.setAttribute("name", "rowsPerPage");
        hiddenField2.setAttribute("value", rowsPerPage);
        form.appendChild(hiddenField2);

        let hiddenField3 = document.createElement("input");
        hiddenField3.setAttribute("type", "hidden");
        hiddenField3.setAttribute("name", "srchText");
        hiddenField3.setAttribute("value", srchText);
        form.appendChild(hiddenField3);

        let hiddenField4 = document.createElement("input");
        hiddenField4.setAttribute("type", "hidden");
        hiddenField4.setAttribute("name", "srchOption");
        hiddenField4.setAttribute("value", srchOption);
        form.appendChild(hiddenField4);


     


        let hiddenField7 = document.createElement("input");
        hiddenField7.setAttribute("type", "hidden");
        hiddenField7.setAttribute("name", "srtDt");
        hiddenField7.setAttribute("value", srtDt);
        form.appendChild(hiddenField7);

        let hiddenField8 = document.createElement("input");
        hiddenField8.setAttribute("type", "hidden");
        hiddenField8.setAttribute("name", "endDt");
        hiddenField8.setAttribute("value", endDt);
        form.appendChild(hiddenField8);

        document.body.appendChild(form);
        form.submit();
      }
  
    </script>
  </body>

</html>